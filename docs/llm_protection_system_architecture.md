# 本地大模型防护系统部署架构

```
+-----------------------------------------------------------------------------------------------+
|                                                                                               |
|                                  本地大模型防护系统                                              |
|                                                                                               |
+-----------------------------------------------------------------------------------------------+
                  ^                          |                           ^
                  |                          |                           |
                  |                          v                           |
+------------------+    +--------------------------------------------------+    +------------------+
|                  |    |                                                  |    |                  |
|   用户应用/客户端   |--->|                  安全代理层                      |--->|    本地大模型     |
|                  |    |        (请求拦截、安全检查、响应过滤)                |    |                  |
|                  |<---|                                                  |<---|                  |
+------------------+    +--------------------------------------------------+    +------------------+
                         |              |               |              |
                         |              |               |              |
                         v              v               v              v
              +----------------+ +---------------+ +------------+ +-------------+
              |                | |               | |            | |             |
              |  提示注入检测   | | 越狱尝试识别  | | 敏感信息   | |  有害内容   |
              |                | |               | |  过滤      | |  检测       |
              +----------------+ +---------------+ +------------+ +-------------+
                         |              |               |              |
                         |              |               |              |
                         v              v               v              v
                        +--------------------------------------------------+
                        |                                                  |
                        |                 安全事件管理                      |
                        |          (记录、分析、告警、报告)                 |
                        |                                                  |
                        +--------------------------------------------------+
                                           |
                                           |
                                           v
                        +--------------------------------------------------+
                        |                                                  |
                        |                 管理控制台                        |
                        |     (监控面板、规则配置、模型管理、日志查看)       |
                        |                                                  |
                        +--------------------------------------------------+
                                           ^
                                           |
                                           |
                        +--------------------------------------------------+
                        |                                                  |
                        |                 管理员/用户                       |
                        |                                                  |
                        +--------------------------------------------------+
```

## 架构说明

### 1. 核心组件

- **安全代理层**：系统的核心组件，负责拦截和处理所有进出大模型的请求和响应
  - 接收来自用户应用的请求
  - 对请求进行安全检查
  - 将安全的请求转发给大模型
  - 对大模型的响应进行过滤
  - 将安全的响应返回给用户应用

- **安全检测模块**：
  - **提示注入检测**：识别和阻止各类提示注入攻击
  - **越狱尝试识别**：检测绕过安全限制的行为
  - **敏感信息过滤**：保护个人信息和敏感凭证
  - **有害内容检测**：过滤不当内容

- **安全事件管理**：记录、分析和管理安全事件
  - 事件记录和分类
  - 事件分析和统计
  - 安全告警
  - 报告生成

- **管理控制台**：提供图形化界面进行系统管理
  - 实时监控面板
  - 安全规则配置
  - 模型管理
  - 日志和事件查看

### 2. 数据流向

1. **请求流向**：
   - 用户应用发送请求到安全代理层
   - 安全代理层对请求进行安全检查
   - 如果请求安全，转发给本地大模型
   - 如果请求不安全，拦截并返回错误信息

2. **响应流向**：
   - 本地大模型生成响应并发送到安全代理层
   - 安全代理层对响应进行安全检查
   - 如果响应安全，转发给用户应用
   - 如果响应不安全，过滤或拦截后返回

3. **管理流向**：
   - 管理员通过管理控制台配置系统
   - 管理控制台与安全代理层和安全事件管理交互
   - 安全事件实时反馈到管理控制台

## 部署模式

### 1. 单机部署

适用于个人开发者或小型团队，所有组件部署在同一台服务器上：
- 本地大模型（如Ollama）
- 本地大模型防护系统
- 用户应用

### 2. 分布式部署

适用于企业环境，组件可分布在不同服务器上：
- 大模型服务器：运行本地大模型
- 防护系统服务器：运行本地大模型防护系统
- 应用服务器：运行用户应用
- 数据库服务器：存储安全事件和日志

### 3. 容器化部署

使用Docker和Kubernetes进行容器化部署：
- 每个组件打包为独立容器
- 使用Kubernetes编排和管理容器
- 支持水平扩展和高可用配置
